<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Login - Electro</title>

		<!-- Google font -->
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		
		<!-- Font Awesome Icon -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

		<!-- Custom stlylesheet -->
		<link type="text/css" rel="stylesheet" href="css/style.css"/>
		
		<!-- Login Page Styles -->
		<link type="text/css" rel="stylesheet" href="css/login.css"/>
	</head>

	<body>
		<div class="auth-container">
			<div class="auth-card">
				<div class="auth-header">
					<span class="brand-logo"><i class="fa fa-bolt"></i></span>
					<h2>ELECTRO</h2>
					<p style="margin: 10px 0 0 0; opacity: 0.9; font-size: 16px;">Welcome back to your account</p>
				</div>

				<div class="auth-body">
					<div id="alert-container"></div>

					<form id="loginForm">
						<div class="form-group">
							<label for="email">Email Address</label>
							<input type="email" class="form-control" id="email" name="email" required>
						</div>

						<div class="form-group">
							<label for="password">Password</label>
							<div class="password-toggle">
								<input type="password" class="form-control" id="password" name="password" required>
								<button type="button" class="toggle-btn" onclick="togglePassword()">
									<i class="fa fa-eye"></i>
								</button>
							</div>
						</div>

						<div class="form-group">
							<div class="checkbox">
								<label>
									<input type="checkbox" id="remember" name="remember"> Remember me
								</label>
							</div>
						</div>

						<button type="submit" class="btn btn-login">
							<i class="fa fa-sign-in"></i> Login
						</button>
					</form>

					<div class="social-login">
						<p style="text-align: center; color: #666; margin-bottom: 15px;">Or login with</p>
						
						<button class="btn social-btn" onclick="socialLogin('google')">
							<i class="fa fa-google"></i> Google
						</button>
						
						<button class="btn social-btn" onclick="socialLogin('facebook')">
							<i class="fa fa-facebook"></i> Facebook
						</button>
					</div>
				</div>

				<div class="auth-footer">
					<p>Don't have an account? <a href="register.html">Sign up here</a></p>
					<p><a href="forgot-password.html">Forgot your password?</a></p>
				</div>
			</div>
		</div>

		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		
		<!-- Bootstrap -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

		<script>
			// Demo credentials for testing
			const demoCredentials = {
				'admin@electro.com': { password: 'admin123', role: 'admin' },
				'user@electro.com': { password: 'user123', role: 'user' },
				'demo@electro.com': { password: 'demo123', role: 'user' }
			};

			// Initialize users array with demo credentials if empty
			function initializeUsers() {
				const users = JSON.parse(localStorage.getItem('users') || '[]');
				const demoUsers = [
					{
						firstName: 'Admin',
						lastName: 'User',
						email: 'admin@electro.com',
						password: 'admin123',
						role: 'admin',
						createdAt: new Date().toISOString()
					},
					{
						firstName: 'Demo',
						lastName: 'User',
						email: 'user@electro.com',
						password: 'user123',
						role: 'user',
						createdAt: new Date().toISOString()
					},
					{
						firstName: 'Demo',
						lastName: 'Account',
						email: 'demo@electro.com',
						password: 'demo123',
						role: 'user',
						createdAt: new Date().toISOString()
					}
				];
				
				// Check if demo users exist, if not add them
				const existingEmails = users.map(u => u.email);
				const missingDemoUsers = demoUsers.filter(demo => !existingEmails.includes(demo.email));
				
				if (missingDemoUsers.length > 0) {
					// Add missing demo users
					const updatedUsers = [...users, ...missingDemoUsers];
					localStorage.setItem('users', JSON.stringify(updatedUsers));
					console.log('Added demo users:', missingDemoUsers.map(u => u.email));
				}
			}

			function showAlert(message, type = 'info') {
				const alertContainer = document.getElementById('alert-container');
				const alertClass = type === 'error' ? 'alert-danger' : type === 'success' ? 'alert-success' : 'alert-info';
				
				alertContainer.innerHTML = `
					<div class="alert ${alertClass} alert-dismissible">
						<button type="button" class="close" data-dismiss="alert">&times;</button>
						${message}
					</div>
				`;
			}

			function togglePassword() {
				const passwordField = document.getElementById('password');
				const toggleBtn = document.querySelector('.toggle-btn i');
				
				if (passwordField.type === 'password') {
					passwordField.type = 'text';
					toggleBtn.className = 'fa fa-eye-slash';
				} else {
					passwordField.type = 'password';
					toggleBtn.className = 'fa fa-eye';
				}
			}

			function socialLogin(provider) {
				showAlert(`Logging in with ${provider}... (Demo mode)`, 'info');
				setTimeout(() => {
					showAlert('Social login would be implemented with real OAuth providers', 'info');
				}, 1000);
			}

			document.getElementById('loginForm').addEventListener('submit', function(e) {
				e.preventDefault();
				
				const email = document.getElementById('email').value;
				const password = document.getElementById('password').value;
				const remember = document.getElementById('remember').checked;

				// Get all users from localStorage
				const users = JSON.parse(localStorage.getItem('users') || '[]');
				
				// Find user by email
				let user = users.find(u => u.email === email);
				
				// If user not found in localStorage, check demo credentials
				if (!user && demoCredentials[email] && demoCredentials[email].password === password) {
					user = {
						email: email,
						password: password,
						role: demoCredentials[email].role,
						firstName: email.split('@')[0],
						lastName: 'Demo'
					};
				}
				
				if (user && user.password === password) {
					// Store user session
					const userData = {
						email: email,
						role: user.role,
						loginTime: new Date().toISOString(),
						remember: remember
					};
					
					localStorage.setItem('user', JSON.stringify(userData));
					
					showAlert('Login successful! Redirecting...', 'success');
					
					setTimeout(() => {
						// Redirect admin users to admin panel, others to homepage
						if (user.role === 'admin') {
							window.location.href = 'admin-panel.html';
						} else {
							window.location.href = 'index.html';
						}
					}, 1500);
				} else {
					showAlert('Invalid email or password. Please check your credentials.', 'error');
				}
			});

			// Initialize users and check if user is already logged in
			window.addEventListener('load', function() {
				// Initialize users array with demo credentials if empty
				initializeUsers();
				
				const user = JSON.parse(localStorage.getItem('user'));
				if (user) {
					showAlert('You are already logged in. Redirecting...', 'info');
					setTimeout(() => {
						// Redirect admin users to admin panel, others to homepage
						if (user.role === 'admin') {
							window.location.href = 'admin-panel.html';
						} else {
							window.location.href = 'index.html';
						}
					}, 1500);
				}
			});
		</script>
	</body>
</html>